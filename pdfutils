#!/usr/bin/env bash

UND=`tput smul`
NOUND=`tput rmul`
BLD=`tput bold`
NRML=`tput sgr0`

pdfcompress() {
    # Compress image based PDF size
    gs -sDEVICE=pdfwrite \
       -dCompatibilityLevel=1.4 \
       -dDownsampleColorImages=true \
       -dColorImageResolution=132 \
       -dNOPAUSE -dBATCH \
       -sOutputFile=${1}_compressed_$(date +%s) \
       "$1" # The input file to be compressed
}

pdfsplit() {
    gs -sDEVICE=pdfwrite \
       -dNOPAUSE -dBATCH -dSAFER \
       -dFirstPage=${2} \
       -dLastPage=${3} \
       -sOutputFile=${1%.pdf}_p${2}-p${3}.pdf \
       ${1} # The input file to be split
}

cathelp() {
    cat << _EOF
D}NAME${NRML}
pdfutils - Simple script to interact with Ghostscript and pdftoppm

D}OPTIONS${NRML}
-c|--compress ${UND}pdf-file${NOUND}
    Compress an image based pdf file
-e|--extract ${UND}pdf-file${NOUND}
    Extracts all pages as png files
-s|--split ${UND}pdf-file${NOUND} ${UND}first page of range${NOUND} ${UND}last page of range${NOUND}
    Splits a pdf file based on specified first and last page range into a new pdf file" 
-h|--help
    Prints this help

_EOF
}

case $1 in
    -c|--compress)
        shift; pdfcompress $1 ;;
    -e|--extract) 
        shift
        pdftoppm -png $1 ${1%.pdf} ;;
    -s|--split) 
        shift; pdfsplit $@ ;;
    -h|--help) 
        cathelp ;;
    *)
        echo 'Invalid Option'
        cathelp
        exit 1 ;;
esac
